dist: xenial
sudo: true

language: python

cache:
  apt: true
  directories:
  - $HOME/.cache/pip
  - $HOME/.ccache

matrix:
  include:
    # Ubuntu builds: no numpy, numpy, numpy + pillow (both), numpy + pillow(jpeg)
    - name: "Python 2.7 -> numpy -> numpy + pillow (jpeg) -> numpy + pillow (both)"
      python: 2.7
      env: DISTRIB="ubuntu" PYTHON_VERSION="2.7" NUMPY=false PILLOW=false JPEG_LS=false GDCM=false
    - name: "Python 3.4 -> numpy -> numpy + pillow (jpeg) -> numpy + pillow (both)"
      python: 3.4
      env: DISTRIB="ubuntu" PYTHON_VERSION="3.4" NUMPY=false PILLOW=false JPEG_LS=false GDCM=false
    - name: "Python 3.5 -> numpy -> numpy + pillow (jpeg) -> numpy + pillow (both)"
      python: 3.5
      env: DISTRIB="ubuntu" PYTHON_VERSION="3.5" NUMPY=false PILLOW=false JPEG_LS=false GDCM=false
    - name: "Python 3.6 -> numpy -> numpy + pillow (jpeg) -> numpy + pillow (both)"
      python: 3.6
      env: DISTRIB="ubuntu" PYTHON_VERSION="3.6" NUMPY=false PILLOW=false JPEG_LS=false GDCM=false
    - name: "Python 3.7 -> numpy -> numpy + pillow (jpeg) -> numpy + pillow (both)"
      python: 3.7
      env: DISTRIB="ubuntu" PYTHON_VERSION="3.7" NUMPY=false PILLOW=false JPEG_LS=false GDCM=false

    # PyPy builds" numpy
    - name: "PyPy 2.7 with numpy"
      env: DISTRIB="pypy" PYTHON_VERSION="2.7" NUMPY=true PILLOW=false JPEG_LS=false GDCM=false
    - name: "PyPy 3.5 with numpy"
      env: DISTRIB="pypy" PYTHON_VERSION="3.5" NUMPY=true PILLOW=false JPEG_LS=false GDCM=false

    # Conda builds: numpy + JPEG-LS, numpy + GDCM
    - name: "Conda 2.7 with numpy and JPEG-LS"
      env: DISTRIB="conda" PYTHON_VERSION="2.7" NUMPY=true  PILLOW=false JPEG_LS=true GDCM=false
    - name: "Conda 2.7 with numpy and GDCM"
      env: DISTRIB="conda" PYTHON_VERSION="2.7" NUMPY=true  PILLOW=false JPEG_LS=false GDCM=true
    - name: "Conda 3.4 with numpy and JPEG-LS"
      env: DISTRIB="conda" PYTHON_VERSION="3.4" NUMPY=true  PILLOW=false JPEG_LS=true GDCM=false
    - name: "Conda 3.4 with numpy and GDCM"
      env: DISTRIB="conda" PYTHON_VERSION="3.4" NUMPY=true  PILLOW=false JPEG_LS=false GDCM=true
    - name: "Conda 3.5 with numpy and JPEG-LS"
      env: DISTRIB="conda" PYTHON_VERSION="3.5" NUMPY=true  PILLOW=false JPEG_LS=true GDCM=false
    - name: "Conda 3.5 with numpy and GDCM"
      env: DISTRIB="conda" PYTHON_VERSION="3.5" NUMPY=true  PILLOW=false JPEG_LS=false GDCM=true
    - name: "Conda 3.6 with numpy and JPEG-LS"
      env: DISTRIB="conda" PYTHON_VERSION="3.6" NUMPY=true  PILLOW=false JPEG_LS=true  GDCM=false
    - name: "Conda 3.6 with numpy and GDCM"
      env: DISTRIB="conda" PYTHON_VERSION="3.6" NUMPY=true  PILLOW=false JPEG_LS=false  GDCM=true
    # Test old version of GDCM for `HAVE_GDCM_IN_MEMORY_SUPPORT = False`, only for Python 3.6
    - name: "Conda 3.6 with numpy and GDCM 2.8.4"
      env: DISTRIB="conda" PYTHON_VERSION="3.6" NUMPY=true  PILLOW=false JPEG_LS=false GDCM=old
    #- env: DISTRIB="conda" PYTHON_VERSION="3.7" NUMPY=true  PILLOW=false JPEG_LS=true GDCM=false
    - name: "Conda 3.7 with numpy and GDCM"
      env: DISTRIB="conda" PYTHON_VERSION="3.7" NUMPY=true  PILLOW=false JPEG_LS=false GDCM=true

install: source build_tools/travis/install.sh

script: source build_tools/travis/run_script.sh
